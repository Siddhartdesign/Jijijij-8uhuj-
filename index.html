<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Anne — Calendar Prototype</title>

<!-- EB Garamond for header -->
<link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

<style>
  /* ---------- Palette (user choices) ---------- */
  :root{
    --global-bg-top: #DBD1C7;   /* top header box */
    --page-bg: #D2C6BB;         /* background behind whole thing */
    --panel-bg: #FFFFFF;       /* panels/cards base (kept white for contrast) */
    --entry-panel-bg: #D5CABE;  /* entry panel color you chose */
    --day-highlight: #DBACAA;   /* highlighted day tile */
    --milestone-dot: #B68312;   /* gold dot */
    --header-ink: #23190F;      /* header title text */
    --body-ink: #241A10;        /* warm ink for body text */
    --muted: #9c8f84;
    --cell-border: rgba(0,0,0,0.06);
    --max-width: 1100px;
  }

  /* ---------- Base ---------- */
  * { box-sizing: border-box; }
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:var(--page-bg);color:var(--body-ink);}
  .app{max-width:var(--max-width);margin:28px auto;padding:0 20px 36px;}

/* ---------- Header ---------- */
.header {
  display:flex;align-items:center;gap:18px;
  background:var(--global-bg-top);padding:18px;border-radius:10px;
  box-shadow:0 6px 18px rgba(0,0,0,0.04);margin-bottom:18px;
}
.header .photo {
  width:72px;height:72px;border-radius:6px;overflow:hidden;flex:0 0 72px;border:1px solid rgba(0,0,0,0.06);
  display:flex;align-items:center;justify-content:center;background:#fff;
}
.header .photo img{width:100%;height:100%;object-fit:cover;display:block}
.header .title {
  font-family: 'EB Garamond', serif;color:var(--header-ink);
  font-size:28px;font-weight:700;line-height:1;
}

/* ---------- Controls row (month switcher) ---------- */
.controls-bar{display:flex;align-items:center;justify-content:center;margin-bottom:14px;}
.pill {
  display:inline-flex;align-items:center;gap:12px;padding:10px 18px;border-radius:999px;
  background:var(--panel-bg);box-shadow:0 8px 20px rgba(0,0,0,0.04);border:1px solid var(--cell-border);
  font-weight:600;color:var(--body-ink);
}
.pill button{background:transparent;border:0;font-size:1.0rem;cursor:pointer;padding:6px}

/* ---------- Layout ---------- */
.layout{display:flex;gap:22px;align-items:flex-start}
.entry-panel{width:320px;background:var(--entry-panel-bg);padding:18px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.04);color:var(--body-ink);height:calc(100vh - 240px);overflow:auto}
.entry-panel h2{margin:0 0 10px 0;font-family:'EB Garamond',serif;font-weight:700;color:var(--header-ink)}
.entry-content{white-space:pre-wrap;line-height:1.5;color:var(--body-ink);font-size:0.98rem}

/* ---------- Calendar ---------- */
.calendar{flex:1;min-width:0}
.weekday-row{display:grid;grid-template-columns:repeat(7,1fr);text-align:center;font-weight:700;margin-bottom:8px;color:var(--muted);letter-spacing:.02em}
.grid{display:grid;grid-template-columns:repeat(7,1fr);gap:12px}
.day{background:var(--panel-bg);border:1px solid var(--cell-border);padding:14px;min-height:82px;border-radius:8px;position:relative;cursor:pointer;display:flex;flex-direction:column;align-items:flex-start}
.day:hover{transform:translateY(-2px);transition:transform .12s}
.day-number{font-weight:700;font-size:1.05rem;color:var(--header-ink)}
.empty-cell{background:transparent;border:0;min-height:82px}

/* highlighted days and milestone dot */
.has-entry{background:var(--day-highlight);border-color:rgba(0,0,0,0.06)}
.milestone-dot{width:10px;height:10px;border-radius:50%;position:absolute;top:10px;right:10px;background:var(--milestone-dot);box-shadow:0 1px 2px rgba(0,0,0,0.08)}

/* selected day style (slightly stronger outline) */
.day.selected{box-shadow:inset 0 0 0 2px rgba(182,130,82,0.10);outline:2px solid rgba(0,0,0,0.03)}

/* smaller screens */
@media (max-width:920px){
  .layout{flex-direction:column;padding-bottom:36px}
  .entry-panel{width:100%;height:auto;order:2}
  .calendar{order:3}
  .header .title{font-size:22px}
  .header .photo{width:56px;height:56px}
  .day{min-height:64px;padding:10px}
}
</style>
</head>
<body>
<div class="app">

  <!-- HEADER -->
  <div class="header" role="banner">
    <div class="photo" title="Anne">
      <!-- using uploaded portrait; replace src if you want another -->
      <img src="anne.jpg" alt="Anne portrait">
    </div>
    <div>
      <div class="title">Anne’s atlas</div>
    </div>
  </div>

  <!-- MONTH SWITCHER -->
  <div class="controls-bar">
    <div class="pill" role="group" aria-label="Month selector">
      <button id="prevMonth" aria-label="Previous month">◀</button>
      <div id="monthLabel" style="min-width:140px;text-align:center"></div>
      <button id="nextMonth" aria-label="Next month">▶</button>
    </div>
  </div>

  <!-- MAIN LAYOUT -->
  <div class="layout">
    <aside class="entry-panel" aria-labelledby="entryHeading">
      <h2 id="entryHeading">Entries</h2>
      <div id="entryContent" class="entry-content">Loading…</div>
    </aside>

    <main class="calendar" aria-live="polite">
      <div class="weekday-row">
        <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
      </div>
      <div id="calendarGrid" class="grid" role="grid" aria-label="Monthly calendar"></div>
    </main>
  </div>
</div>

<script>
/* ---------- Config / Colors (JS-level) ---------- */
const JSON_FILE = "Anne_Frank_Diary.json";
const MONTHS = ["January","February","March","April","May","June","July","August","September","October","November","December"];

/* ---------- State ---------- */
let entriesMap = {}; // "YYYY-MM-DD" => [entry, ...]
let currentYear = 1942;
let currentMonth = 5; // June (0-based)
let selectedDay = null;

/* ---------- Small helpers ---------- */
function pad(n){return String(n).padStart(2,'0');}
function iso(y,m,d){ return `${y}-${pad(m+1)}-${pad(d)}`; }
function parseDDMMYYYY(s){
  if(!s) return null;
  const p = s.split("/").map(Number);
  if(p.length!==3) return null;
  return { y:p[2], m:p[1]-1, d:p[0], dateObj: new Date(p[2], p[1]-1, p[0]) };
}
function includesYes(v){ return v && String(v).toUpperCase().includes("YES"); }
function textPreview(t,max=300){ if(!t) return ""; return t.length>max? t.slice(0,max).trim().replace(/\s+[^\s]*$/,'') + "…" : t; }

/* ---------- Load JSON and build entriesMap ---------- */
fetch(JSON_FILE)
  .then(r => { if(!r.ok) throw new Error('Failed to load JSON'); return r.json(); })
  .then(json => {
    const chron = json.chronological_data || json.chronologicalData || {};
    buildEntriesMap(chron);
    const earliest = findEarliestMonth();
    if(earliest){ currentYear = earliest.year; currentMonth = earliest.month; }
    renderCalendar();
    autoSelectFirstEntryForMonth();
  })
  .catch(err => {
    document.getElementById('entryContent').textContent = "Unable to load data.";
    console.error(err);
  });

function buildEntriesMap(root){
  entriesMap = {};
  Object.keys(root || {}).forEach(yKey=>{
    const months = root[yKey] || {};
    Object.keys(months).forEach(monthName=>{
      const arr = months[monthName] || [];
      arr.forEach(item=>{
        const parsed = parseDDMMYYYY(item.date);
        if(!parsed) return;
        const key = iso(parsed.y, parsed.m, parsed.d);
        if(!entriesMap[key]) entriesMap[key] = [];
        entriesMap[key].push(Object.assign({}, item, {_year:parsed.y, _month:parsed.m, _day:parsed.d, _dateObj:parsed.dateObj}));
      });
    });
  });
}

function findEarliestMonth(){
  const keys = Object.keys(entriesMap);
  if(!keys.length) return null;
  let earliest = null;
  keys.forEach(k=>{
    const [y,mm,dd] = k.split("-").map(Number);
    const d = new Date(y, mm-1, dd);
    if(!earliest || d < earliest) earliest = d;
  });
  if(!earliest) return null;
  return { year: earliest.getFullYear(), month: earliest.getMonth() };
}

/* ---------- Render calendar ---------- */
const calendarGrid = document.getElementById('calendarGrid');
const monthLabel = document.getElementById('monthLabel');
const entryContent = document.getElementById('entryContent');

function renderCalendar(){
  calendarGrid.innerHTML = "";
  monthLabel.textContent = `${MONTHS[currentMonth]} ${currentYear}`;

  const firstDay = new Date(currentYear, currentMonth, 1).getDay();
  const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

  // leading blanks
  for(let i=0;i<firstDay;i++){
    const blank = document.createElement('div');
    blank.className = 'empty-cell';
    calendarGrid.appendChild(blank);
  }

  // days
  for(let d=1; d<=daysInMonth; d++){
    const tile = document.createElement('div');
    tile.className = 'day';
    tile.innerHTML = `<div class="day-number">${d}</div>`;

    const key = iso(currentYear, currentMonth, d);
    const items = entriesMap[key] || [];

    if(items.length){
      tile.classList.add('has-entry');
      if(items.some(e => includesYes(e.milestone))){
        const dot = document.createElement('div');
        dot.className = 'milestone-dot';
        tile.appendChild(dot);
      }
      tile.addEventListener('click', ()=> { selectedDay = d; showEntryForDay(d); renderCalendar(); });
    } else {
      tile.addEventListener('click', ()=> { selectedDay = d; clearEntryPanel(); renderCalendar(); });
    }

    if(selectedDay === d){
      tile.classList.add('selected');
    }

    calendarGrid.appendChild(tile);
  }

  // trailing blanks
  const total = firstDay + daysInMonth;
  const needed = Math.ceil(total/7)*7;
  for(let i=0;i<needed-total;i++){
    const blank = document.createElement('div');
    blank.className = 'empty-cell';
    calendarGrid.appendChild(blank);
  }
}

/* ---------- Entry panel ---------- */
function showEntryForDay(day){
  const key = iso(currentYear, currentMonth, day);
  const arr = entriesMap[key] || [];
  if(!arr.length){
    entryContent.innerHTML = "<em>No entry for this day.</em>";
    return;
  }
  const e = arr[0];
  entryContent.innerHTML = `
    <div style="margin-bottom:10px;font-weight:700;color:var(--header-ink)">${e.day_of_week || weekdayLabel(e._year,e._month,e._day)} — ${pad(e._day)}/${pad(e._month+1)}/${e._year}</div>
    <div style="opacity:.85;margin-bottom:8px"><strong>Theme:</strong> ${e.theme || '-'}</div>
    <div style="opacity:.85;margin-bottom:12px"><strong>Milestone:</strong> ${e.milestone || 'No'}</div>
    <div style="color:var(--body-ink)">${e.text ? e.text : ''}</div>
  `;
}

function clearEntryPanel(){
  entryContent.innerHTML = "Select a day";
}

/* ---------- Auto-select first entry in the month ---------- */
function autoSelectFirstEntryForMonth(){
  const keys = Object.keys(entriesMap).filter(k=>{
    const [y,mm,dd] = k.split("-").map(Number); return y === currentYear && (mm-1) === currentMonth;
  }).sort();
  if(keys.length){
    const [y,mm,dd] = keys[0].split("-").map(Number);
    selectedDay = dd;
    showEntryForDay(dd);
    renderCalendar();
  } else {
    selectedDay = null;
    clearEntryPanel();
    renderCalendar();
  }
}

/* ---------- Utils ---------- */
function weekdayLabel(y,m,d){ return new Date(y,m,d).toLocaleDateString(undefined,{weekday:'long'}); }

/* ---------- Navigation ---------- */
document.getElementById('prevMonth').addEventListener('click', ()=>{
  currentMonth--; if(currentMonth < 0){ currentMonth = 11; currentYear--; } autoSelectFirstEntryForMonth();
});
document.getElementById('nextMonth').addEventListener('click', ()=>{
  currentMonth++; if(currentMonth > 11){ currentMonth = 0; currentYear++; } autoSelectFirstEntryForMonth();
});
</script>
</body>
</html>
